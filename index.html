<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity Web Player | House of Avatars</title>
    <style>
      body {
        text-align: center;
        padding: 0;
        border: 0;
        margin: 0;
        overflow: hidden; /* Evita rolagem na tela */
        background-color: #231F20; /* Match Unity background */
        color: #cccccc; /* Light text for contrast */
        font-family: sans-serif;
      }
      /* --- Loading Overlay --- */
      #loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #231F20; /* Same as body/canvas */
        display: flex;
        flex-direction: column; /* Stack elements vertically */
        justify-content: center;
        align-items: center;
        z-index: 2; /* Ensure it's above the canvas */
      }
      #progress-bar-container {
        width: 80%;
        max-width: 400px; /* Limit max width */
        height: 20px;
        background-color: #444; /* Darker grey background for the bar */
        border: 1px solid #555;
        border-radius: 10px;
        overflow: hidden; /* Clip the inner bar */
        margin-bottom: 10px; /* Space between bar and text */
      }
      #progress-bar {
        width: 0%; /* Start at 0 */
        height: 100%;
        background-color: #4CAF50; /* Green progress color */
        transition: width 0.2s ease-out; /* Smooth transition */
      }
      #progress-text {
        font-size: 1em;
      }
      /* --- Unity Canvas --- */
      #unity-canvas {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        background: #231F20; /* Keep background consistent */
        z-index: 1; /* Below the loading overlay */
      }
    </style>
  </head>
  <body>
    <!-- Loading Progress Bar Elements -->
    <div id="loading-overlay">
      <div id="progress-bar-container">
        <div id="progress-bar"></div>
      </div>
      <div id="progress-text">Loading... 0%</div>
    </div>

    <!-- Unity Canvas -->
    <canvas id="unity-canvas" tabindex="-1"></canvas>

    <!-- Unity Loader Script -->
    <script src="Build/newWebBuilds.loader.js"></script>

    <script>
      // --- Get References to Loading Elements ---
      const loadingOverlay = document.getElementById('loading-overlay');
      const progressBar = document.getElementById('progress-bar');
      const progressText = document.getElementById('progress-text');

      // --- Canvas Resizing ---
      function resizeCanvas() {
        var canvas = document.getElementById("unity-canvas");
        var aspectRatio = 1366 / 768;
        var width = window.innerWidth;
        var height = window.innerHeight;

        if (width / height > aspectRatio) {
          width = height * aspectRatio;
        } else {
          height = width / aspectRatio;
        }

        canvas.style.width = width + "px";
        canvas.style.height = height + "px";
        // Note: Setting canvas.width/height might be handled by Unity itself
        // depending on 'matchWebGLToCanvasSize'. Keep an eye on this if resizing issues occur.
        // canvas.width = width;
        // canvas.height = height;
      }

      window.addEventListener("resize", resizeCanvas);
      // No need to call resizeCanvas on load manually, Unity initialization will handle it.

      // --- Mobile Viewport Meta Tag ---
      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        var meta = document.createElement('meta');
        meta.name = 'viewport';
        meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
        document.getElementsByTagName('head')[0].appendChild(meta);
      }

      // --- Create Unity Instance with Progress Callback ---
      createUnityInstance(document.querySelector("#unity-canvas"), {
        arguments: [],
        dataUrl: "Build/newWebBuilds.data",
        frameworkUrl: "Build/newWebBuilds.framework.js",
        codeUrl: "Build/newWebBuilds.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "House of Avatars",
        productName: "House of Avatars",
        productVersion: "1.2.6.0",
        // matchWebGLToCanvasSize: false, // Keep commented unless needed
        // devicePixelRatio: 1, // Keep commented unless needed

        // --- Progress Handling ---
        // Note: In older Unity versions, this might be inside a 'Module' object: Module: { onProgress: function... }
        onProgress: function (progress) {
          const percentage = Math.round(progress * 100);
          progressBar.style.width = percentage + '%';
          progressText.textContent = `Loading... ${percentage}%`;

          // Hide overlay when loading is complete (progress reaches 1)
          if (progress === 1) {
            // Use a small delay to ensure the last frame of the progress bar is rendered
            // and to make the transition less abrupt.
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
            }, 250); // Adjust delay as needed (e.g., 250ms)
          }
        },
      }).then((unityInstance) => {
        // Unity instance successfully created.
        // You could potentially do other things here after loading.
        console.log("Unity instance created successfully.");
        // Initial resize after instance is ready (optional, Unity often handles this)
        resizeCanvas();
      }).catch((message) => {
        // Handle errors during instantiation
        alert(message);
        progressText.textContent = "Error loading application. Please check console.";
        progressBar.style.backgroundColor = "#ff0000"; // Indicate error with red bar
      });
    </script>
  </body>
</html>
